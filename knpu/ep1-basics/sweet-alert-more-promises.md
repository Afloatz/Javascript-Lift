# Sweet Alert More Promises

 For our last trick, Google for a library called Sweetalert2. This is a JavaScript library that very simply gives us awesome modals like this. In fact, you can even use it to get different things where you have a yes button and a cancel button. We're going to use it so that when we click the delete icon, we pop up something that looks kind of like this and then they can confirm whether or not they want to delete it. To get this installed, go to the CDN. We'll copy the JavaScript file. We'll go over it and this time, instead of putting this in our base layout, we'll put this just on this page, so index that [inaudible 00:00:43]. Add a script, asterix to equals. This also comes with a CSS file, so we'll copy that as well, and we'll override block style sheets. End block. Call parent to include the normal list of style sheets. Then we'll add a link tag and I'll paste that. Perfect.

 The way that this library works is it exposes a global SWAL object. I actually copy the timer example, which is somewhat similar to ours, then we'll go into our rep log app.js. We know whenever we reference a global object, we like to pass it into our self-executing function instead of referencing it globally. You don't have to, but we do it because it's kind of hipster. Pass SWAL on the bottom and also SWAL on top. If you want to get some auto-complete on that, you can of course hit option, enter, and tell your editor to download that library. Cool.

 Down on handleRepLogDelete, what we're going to do is basically pop the modal and then when they click okay, we're going to run all of our code down here which actually deletes the rep log. To set us for that, I'm actually going to isolate that into its own new function called _deleteRepLog with a link argument. This doesn't change anything. We could still just call this function directly from up here, but instead, paste the Sweetalert code, and now update the title and the text for our situation.  Delete this log.   What? Did you not actually lift this?  Remove the timer option. We don't need that. Replace it with a showCancelButton true.

 Now just with that, we should be able to go over, refresh the page, and oh, we get an error. SWAL is not defined down here at the bottom. Of course, we have to be a little more careful with our ordering. This is something we're going to fix in a future tutorial, but right now, we still need to make sure that we always include any libraries we need and we include them in the correct order. We need Sweetalert first so that it can be passed into our Rep Log app. Refresh now, things look happy again. If you click the little x, boom. We get the okay and cancel. Now check this out. When we call Sweetalert, guess what it returns? A promise. We can tell because we have a .then on it with two arguments. The first argument is what happens on success, and the second argument is what happens when it's rejected. In this case, with Sweetalert, we're not making AJAX calls. This simply means that this function will be called if we click okay, and the second function will be called if we click cancel. This means that in the success, we could set a var self = this variable up top and then call our new self._deleteRepLog and pass that link.

 Down in the other function, we don't need to do anything. We'll just call console.log canceled. Go over, refresh this, click the trash icon, hit cancel awesome. If we hit okay, it deletes it. That is why understanding promises is so important. Now we know from promises that you can pass then to arguments or if you want to, we can clean this up a little bit, and actually pass a .catch instead. Doesn't make any difference, it just cleans things up a little bit more. We also know that both functions are passed a value, and what value they're passed depends on the library. If you should put arg here and .catch, and arg here. Go back and refresh, hit cancel. It says cancel. I go back and refresh again and hit escape, you can see it says ESC. This is a cool thing. It turns out in this library, search for promise, near the bottom of the page is a thing called handling dismissals, and it says,  One alert is dismissed by the user.  The reject function is passed one of the strings, which is one of the reasons. Pretty cool.

 There's one other thing you can do with this library that deals with promises. Search for preconfirm. If you pass a preconfirm option, then after you confirm, but before Sweetalert closes, it will call your function. U can do anything inside this function, but if what you need to do is asynchronous, like you want to make an AJAX call, maybe to do some form validation on whatever is inside of your Sweetalert modal, then what you need to do is return a promise. This will tell Sweetalert when you are done doing your work so it can close the modal. An example of this is, first add a showLoaderOnConfirm option set to true. That will show a little loading icon after the user clicks okay, and then add the preconfirm option set to a function, and here we are going to return a new promise. Of course we have to resolve and then reject.

 Just to fake it, let's pretend we need to do some work before we can actually delete the rep log, and it's going to take about a second, so we use the setTimeout function to fake this, pass that function or run it in one second, and here we'll say resolve. Wait one second and then resolve. Refresh that, click delete link, hit okay, and that was it. You see it takes about one second where you see the loading icon before that actually closes, because it's waiting for that to happen. A more realistic example is, sometimes instead of actually doing the work down and then after the modal has closed, you'll actually decide to do it in preconfirm. That way whatever AJAX call you're making, it's happening while the modal is still showing with the loading icon, and guess what? We can do that super, super easy.

 Move the self.repLog up into the preconfirm and return it. Then get of the .then altogether. Doing this is fine as long as the deleteRepLog function returns a promise. In other words, as long as... as long as we return $.AJAX here, that will return a promise and this will be happy. We will still keep the catch here, because when you hit cancel, that will actually resolve reject, and we want to catch that, otherwise you'll actually see an error. Now if you go back and refresh, you'll actually see just the moment it actually waits for that AJAX call to be made. One last thing I notice is I'm still using the .done function. I meant to change that to .then so that we're using the promise functionality. You can see that it doesn't make any difference. I also do the same thing up in loadRepLogs, but I want to use the true promise functions, not the .done that only lives on jQuery. That's my mistake from earlier.

 I hope you guys thoroughly enjoyed this. You took a big step forward in your Javascript and in a future tutorial, we're going to talk about ES6. A lot of new Javascript features that I haven't shown you yet, because you need to do a little more work to use them, but these new ES6 features are going to be key to moving forward. All right guys, see you next time.
 
